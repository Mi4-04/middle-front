(self.webpackChunkmiddle_front=self.webpackChunkmiddle_front||[]).push([[792],{48855:(e,t,n)=>{"use strict";n.d(t,{A:()=>u,n:()=>d});var r=n(9211);class l{constructor(e){this.key=e}is(e){var t;let n=(t=e,(0,r.Mn)(t)&&t.graphQLErrors?t.graphQLErrors.reduce((e,t)=>{var n;let r=null===(n=t.extensions)||void 0===n?void 0:n.exception;return"string"==typeof(null==r?void 0:r.key)&&e.push(r.key),e},[]):[]);return n.some(e=>e===this.key)}}let s=new l("AUTH_TOKEN_ERROR");let o=new l("TOKEN_OUTDATED_ERROR");let i=new l("USER_ALREADY_EXIST_ERROR");let a=new l("USER_NOT_FOUND_ERROR");let c=new l("INCORRECT_PASSWORD_ERROR");let u={InvalidAuthToken:s,AuthTokenExpired:o,UserAlreadyExist:i,UserNotFound:a,IncorrectPassword:c};function d(e){return e instanceof Error&&(0,r.Mn)(e)&&e.networkError?"Network error. Please contact support.":"Server error. Something went wrong."}},37414:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(96540);var l=n(67366);function s(){return(0,r.useContext)(l.A)}},95697:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(96540);var l=n(88913);function s(){return(0,r.useContext)(l.A)}},15244:(e,t,n)=>{n.nc="ItrilBS/Usx8piRggY25UA=="},44866:(e,t,n)=>{"use strict";n(83142),n(16280),n(30067),n(4294),n(18107),n(10838),n(13451),n(44114),n(93514),n(30237),n(13609),n(78347),n(96167),n(93518),n(9391),n(15472),n(69479),n(67357),n(28543),n(25440),n(79978),n(34594),n(29833),n(46594),n(72107),n(95477),n(21489),n(22134),n(3690),n(61740),n(48140),n(75044),n(21903),n(91134),n(48345),n(52568),n(28845),n(373),n(62953),n(64979),n(59848),n(71678),n(3296),n(27208),n(48408)},38706:(e,t,n)=>{"use strict";var r=n(96540);var l=n(5338);var s=n(84976);var o=n(27962);var i=n(75273);var a=n(98008);var c=n(27404);var u=n(28797);var d=n(82081);var h=n(48855);let x=(0,d.S)(e=>{let t=h.A.InvalidAuthToken.is(e)||h.A.AuthTokenExpired.is(e);t&&(e.response&&(e.response.errors=void 0),localStorage.removeItem("auth_token"))});var p=n(74848);let v=localStorage.getItem("auth_token");let m=new o.P({uri:"http://nest-app.local:4300/graphql",credentials:"include",headers:{authorization:v?`Bearer ${v}`:""}});let f=new i.R({link:(0,a.x)(x,m),cache:new c.D,defaultOptions:{watchQuery:{fetchPolicy:"cache-and-network"}}});function j({children:e}){return(0,p.jsx)(u.X,{client:f,children:e})}var g=n(88913);function k({children:e}){let[t,n]=(0,r.useState)([]);let[l,s]=(0,r.useState)(null);let[o,i]=(0,r.useState)({});let a=(0,r.createRef)();return(0,p.jsx)(g.A.Provider,{value:{tracks:t,setTracks:n,trackIndex:l,setTrackIndex:e=>{var n;null!==l&&null!==(n=t[l])&&void 0!==n&&n.id&&i(e=>({...e,[t[l].realId]:!1})),s(e)},trackStates:o,setTrackState:(e,t)=>{i(()=>({[e]:t}))},audioRef:a},children:e})}var A=n(70111);var y=n(85537);var w=n(67366);function C({children:e}){let t=localStorage.getItem("auth_token");let[n,l]=(0,r.useState)(t);let s=(0,A.m)();(0,r.useEffect)(()=>{if(t){let e=(0,y.s)(t);1e3*e.exp<Date.now()&&(localStorage.removeItem("auth_token"),l(null))}},[t]);let o=(0,r.useCallback)(e=>{localStorage.setItem("auth_token",e),l(e)},[l]);let i=(0,r.useCallback)(()=>{localStorage.removeItem("auth_token"),l(null),s.resetStore()},[l,s]);return(0,p.jsx)(w.A.Provider,{value:{accessToken:n,auth:o,logout:i},children:e})}var S=n(47767);var E=n(37414);var _=n(97834);var R=n(89828);var I=n(8532);var b=n(14073);var T=n(69067);var F=n(86990);var O=n(54409);var q=n(95697);var P=n(59580);n(52223);var L=n(85738);let D=L.I4.div.withConfig({componentId:"sc-qqpevs-0"})(["display:flex;align-items:center;gap:20px;"]);let z=L.I4.img.withConfig({componentId:"sc-qqpevs-1"})(["width:60px;height:60px;"]);let M=L.I4.div.withConfig({componentId:"sc-qqpevs-2"})(["flex-direction:column;text-align:start;"]);function B(){var e,t;let{audioRef:n,tracks:r,trackIndex:l,setTrackIndex:s,setTrackState:o}=(0,q.A)();if(0===r.length||null==l)return null;let{name:i,audioUrl:a,realId:c,artist:u,imageUrl:d}=r[l];let h=()=>{l<r.length-1?s(l+1):s(0)};return(0,p.jsx)(P.A,{ref:n,src:a,hasDefaultKeyBindings:!0,showSkipControls:!0,autoPlay:!0,onPause:()=>o(c,!1),onPlay:()=>o(c,!0),onClickNext:h,onClickPrevious:()=>{l-1<0?s(r.length-1):s(l-1)},onEnded:()=>{r.length>0&&h()},header:(0,p.jsxs)(D,{children:[null!=d?e||(e=(0,p.jsx)(z,{src:d,alt:"image"})):null,(0,p.jsxs)(M,{children:[t||(t=(0,p.jsx)("p",{children:i})),(0,p.jsx)("p",{children:null!=u?u:"Unknown"})]})]}),style:{position:"fixed",bottom:0,left:20,maxWidth:"450px",width:"100%",zIndex:2}})}var G;function N({children:e}){let t=(0,S.Zp)();let{logout:n}=(0,E.A)();return(0,p.jsxs)(_.A,{sx:{width:"100%"},children:[(0,p.jsx)(R.A,{component:"nav",children:(0,p.jsxs)(I.A,{children:[(0,p.jsx)(b.A,{variant:"h6",component:"div",sx:{flexGrow:1,display:{xs:"none",sm:"block",cursor:"pointer"}},onClick:()=>t("/home"),children:"Music"}),(0,p.jsxs)(T.A,{sx:{display:"flex",gap:"3rem"},children:[(0,p.jsx)(b.A,{variant:"h6",component:"div",sx:{flexGrow:1,display:{xs:"none",sm:"block",cursor:"pointer"}},onClick:()=>t("/search"),children:"Search track"}),(0,p.jsx)(b.A,{variant:"h6",component:"div",sx:{flexGrow:1,display:{xs:"none",sm:"block",cursor:"pointer"}},onClick:()=>t("/my-playlists"),children:"My playlists"}),(0,p.jsx)("div",{children:(0,p.jsx)(F.A,{sx:{color:"#fff"},onClick:()=>{try{n(),t("/sign-in")}catch(e){(0,O.P)((0,h.n)(e),{type:"error",autoClose:!1})}},children:"Sign out"})})]})]})}),(0,p.jsxs)(_.A,{sx:{mt:10,position:"relative"},children:[e," ",G||(G=(0,p.jsx)(B,{}))]})]})}var U;function H({children:e}){let t=(0,S.Zp)();return(0,p.jsxs)(_.A,{sx:{width:"100%"},children:[(0,p.jsx)(R.A,{component:"nav",children:(0,p.jsxs)(I.A,{children:[(0,p.jsx)(b.A,{variant:"h6",component:"div",sx:{flexGrow:1,display:{xs:"none",sm:"block",cursor:"pointer"}},onClick:()=>t("/home"),children:"Music"}),(0,p.jsxs)(T.A,{sx:{display:"flex",gap:"3rem"},children:[(0,p.jsx)(b.A,{variant:"h6",component:"div",sx:{flexGrow:1,display:{xs:"none",sm:"block",cursor:"pointer"}},onClick:()=>t("/search"),children:"Search track"}),(0,p.jsxs)(T.A,{children:[(0,p.jsx)(F.A,{sx:{color:"#fff"},onClick:()=>t("/sign-up"),children:"Sign up"}),(0,p.jsx)(F.A,{sx:{color:"#fff"},onClick:()=>t("/sign-in"),children:"Login"})]})]})]})}),(0,p.jsxs)(_.A,{sx:{mt:10,position:"relative"},children:[e," ",U||(U=(0,p.jsx)(B,{}))]})]})}function K({children:e}){let{accessToken:t}=(0,E.A)();return(0,p.jsx)(null!=t?N:H,{children:e})}var Q;function W(e){let{children:t,element:n,component:l}=e;let{accessToken:s}=(0,E.A)();return null!=s?t?(0,p.jsx)(p.Fragment,{children:t}):n||(l?(0,r.createElement)(l):null):Q||(Q=(0,p.jsx)(S.C5,{to:"/sign-in"}))}var X;let Y=(0,r.lazy)(async()=>n.e(586).then(n.bind(n,36586)));let Z=(0,r.lazy)(async()=>Promise.all([n.e(324),n.e(71),n.e(142)]).then(n.bind(n,22142)));let $=(0,r.lazy)(async()=>Promise.all([n.e(324),n.e(71),n.e(699)]).then(n.bind(n,23699)));let V=(0,r.lazy)(async()=>n.e(502).then(n.bind(n,55502)));let J=(0,r.lazy)(async()=>Promise.all([n.e(324),n.e(138),n.e(306),n.e(85),n.e(463)]).then(n.bind(n,25463)));function ee(){return X||(X=(0,p.jsx)(K,{children:(0,p.jsx)(r.Suspense,{fallback:(0,p.jsx)("h1",{children:"Loading..."}),children:(0,p.jsx)(S.BV,{children:(0,p.jsxs)(S.qh,{path:"/",children:[(0,p.jsx)(S.qh,{index:!0,element:(0,p.jsx)(S.C5,{to:"/home"})}),(0,p.jsx)(S.qh,{path:"/home/*",element:(0,p.jsx)(Y,{})}),(0,p.jsx)(S.qh,{path:"/sign-up",element:(0,p.jsx)(Z,{})}),(0,p.jsx)(S.qh,{path:"/sign-in",element:(0,p.jsx)($,{})}),(0,p.jsx)(S.qh,{path:"/search",element:(0,p.jsx)(J,{})}),(0,p.jsx)(S.qh,{path:"/my-playlists/*",element:(0,p.jsx)(W,{element:(0,p.jsx)(V,{})})}),(0,p.jsx)(S.qh,{path:"*",element:(0,p.jsx)(S.C5,{to:"/home"})})]})})})}))}function et(e){var t;return null!==(t=null==e?void 0:e.matches)&&void 0!==t&&t}var en=n(99571);n(83967);var er=n(93409);let el=(0,L.Ay)(en.N9).withConfig({componentId:"sc-zf10nu-0"})(["&.Toastify__toast-container{font-weight:500;font-size:16px;line-height:120%;border-radius:10px;padding:8px 16px;& .Toastify__toast--info{color:",";background-color:",";}& .Toastify__toast--error{color:",";background-color:",";}}"],er.xE,er.GL,er.sl,er.z1);function es(){let e=function(e){let t=(0,r.useMemo)(()=>window.matchMedia(`(${e})`),[e]);let[n,l]=(0,r.useState)(()=>et(t));return(0,r.useEffect)(()=>{if(l(et(t)),!t)return;let e=()=>{l(et(t))};return"function"==typeof t.addEventListener?(t.addEventListener("change",e),()=>{t.removeEventListener("change",e)}):(t.addListener(e),()=>{t.removeListener(e)})},[t]),n}("max-width: 599px");return(0,p.jsx)(el,{limit:e?3:5})}var eo;let ei=document.body.querySelector("#app");if(null==ei||!(ei instanceof HTMLElement))throw TypeError("application root element is not found");(async function e(e,t){let n=(0,l.H)(t);return n.render(e),{unmount(){n.unmount()}}})((0,p.jsx)(r.StrictMode,{children:(0,p.jsx)(s.Kd,{children:(0,p.jsx)(function(){return(0,p.jsx)(p.Fragment,{children:eo||(eo=(0,p.jsx)(j,{children:(0,p.jsxs)(k,{children:[(0,p.jsx)(es,{}),(0,p.jsx)(C,{children:(0,p.jsx)(ee,{})})]})}))})},{})})}),ei).catch(console.error)},67366:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(96540);let l=(0,r.createContext)({accessToken:null,auth:()=>{},logout:()=>{}});let s=l},88913:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(96540);let l=(0,r.createContext)({tracks:[],setTracks:()=>{},trackIndex:null,setTrackIndex:()=>{},trackStates:{},setTrackState:()=>{}});let s=l},93409:(e,t,n)=>{"use strict";n.d(t,{GA:()=>u,GL:()=>l,_F:()=>o,c:()=>r,c3:()=>d,sl:()=>s,xE:()=>c,yy:()=>i,z1:()=>a});let r="#FFFFFF";let l="#ECEAFF";let s="#A73725";let o="#757A85";let i="#AFAFBB";let a="#FFDFDF";let c="#0c66d3";let u="#C2CFDF";let d="#35353D"},54409:(e,t,n)=>{"use strict";n.d(t,{P:()=>s});var r=n(99571);let l={type:"info",position:"bottom-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,closeButton:!1,pauseOnHover:!0,icon:!1};let s=(e,t)=>{(0,r.oR)(e,{...l,...t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[657],()=>(t(15244),t(44866),t(38706))),e.O()}]);